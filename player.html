<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Player — Real Madrid</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <main class="container">
    <a id="backLink" href="index.html">← Back</a>
    <div id="player"></div>
  </main>
  <script src="../data/players.js"></script>
  <script>
    function ageFromDate(iso){
      if(!iso) return '';
      const d = new Date(iso);
      if(Number.isNaN(d)) return '';
      const now = new Date();
      let age = now.getFullYear() - d.getFullYear();
      const m = now.getMonth() - d.getMonth();
      if(m < 0 || (m === 0 && now.getDate() < d.getDate())) age--;
      return age;
    }

    function niceDate(iso){
      if(!iso) return '';
      const d = new Date(iso);
      if(Number.isNaN(d)) return iso;
      return d.toLocaleDateString();
    }

    async function loadPlayer(){
      const params = new URLSearchParams(location.search);
      const id = params.get('id');
      const target = document.getElementById('player');
      if(!id){ target.innerText = 'No player specified.'; return; }

      let data = window.PLAYER_DATA;
      if(!data){
        try{ const res = await fetch('../data/players.json'); data = await res.json(); }catch(e){ target.innerText = 'Player data unavailable.'; return; }
      }

      const p = data.find(x=>x.id===id);
      if(!p){ target.innerText = 'Player not found.'; return; }
      document.title = p.name + ' — Real Madrid';
      const local = `../players/images/${p.id}.jpg`;
      const fallback = p.image ? (p.image.startsWith('players/') ? ('../' + p.image) : p.image) : '';
      const age = ageFromDate(p.birthdate);

      target.innerHTML = `
        <h1>${p.name} <span style="font-weight:400;color:#666">#${p.number || ''}</span></h1>
        <img src="${local}" alt="${p.name}" onerror="this.onerror=null;this.src='${fallback}';" style="max-width:360px;display:block;margin-bottom:12px">
        <p><strong>Position:</strong> ${p.position || ''}</p>
        <p><strong>Nationality:</strong> ${p.nationality || ''}</p>
        <p><strong>Birthdate:</strong> ${niceDate(p.birthdate) || ''} ${age?`(<strong>Age</strong>: ${age})`:''}</p>
        <p><strong>Goals:</strong> ${p.goals ?? 0} — <strong>Assists:</strong> ${p.assists ?? 0}</p>
        <h3>Bio</h3>
        <p>${p.bio || ''}</p>
        ${p.wiki?`<p><a href="https://en.wikipedia.org/wiki/${p.wiki}" target="_blank" rel="noopener">Wikipedia</a></p>`:''}
      `;
    }
    loadPlayer();
  </script>
</body>
</html>